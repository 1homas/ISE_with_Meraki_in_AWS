---
# - name: ISE Configuration Playbook
#   hosts: ise
#   gather_facts: no
#   vars_files:
#     vars/main.yaml
#   tasks:


  # ⟁ Wait for ISE Application Server to be available after [re]boot
  - name: Test for ISE Application Server Initialization
    loop: "{{ ise_nodes }}"
    ansible.builtin.include_tasks: tasks/ise_initialized.yaml

  # ⟁ Verify APIs are enabled *before* gathering facts and configuring
  - name: Enable ISE ERS & OpenAPIs
    loop: "{{ ise_nodes }}"
    ansible.builtin.include_tasks: tasks/ise_apis_enabled.yaml


  - name: Create RADIUS Probes - identity_group and internal_users
    ansible.builtin.include_tasks: tasks/radius_probes.yaml
    tags: 
    - create
    - internal_user

  - name: Default Demo Users
    block:
    - name: Include Thomas' Default Demo Users
      ansible.builtin.include_vars: vars/internal_users.yaml
    - name: Create Internal Users
      loop: "{{ internal_users }}"
      ansible.builtin.include_tasks: tasks/internal_user.create.yaml
    tags: 
    - create
    - internal_user


  #----------------------------------------------------------------------------
  # Network Device Groups
  #----------------------------------------------------------------------------

  - name: Create network_device_groups
    block:
    - name: Include network_device_groups
      ansible.builtin.include_vars: vars/network_device_groups.yaml
    - name: Create Network Device Groups
      loop: "{{ network_device_groups }}"
      ansible.builtin.include_tasks: tasks/network_device_group.create.yaml
    tags: 
    - create
    - network_device
    - network_device_group


  - name: Create network_devices
    block:
    - name: Include demo network_devices
      ansible.builtin.include_vars: vars/network_devices.yaml
    - name: Create demo network_devices
      loop: "{{ network_devices }}"
      ansible.builtin.include_tasks: tasks/network_device.create.yaml
    tags: 
    - create
    - network_device


  - name: Endpoint Groups
    block:
    - name: Include Endpoint Groups
      ansible.builtin.include_vars: vars/endpoint_groups.yaml
    - name: Create Endpoint Groups
      loop: "{{ endpoint_groups }}"
      ansible.builtin.include_tasks: tasks/endpoint_group.create.yaml
    tags: 
    - create
    - endpoint


  - name: Create Endpoints
    block:
    - name: Include Endpoints
      ansible.builtin.include_vars: vars/endpoints.yaml
    - name: Create Endpoints
      loop: "{{ endpoints }}"
      ansible.builtin.include_tasks: tasks/endpoint.create.yaml
    tags: 
    - create
    - endpoint



...